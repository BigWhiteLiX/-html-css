var blackFridayInterval;
var blackFridayTime=0;
;(function($){
    var reg = new RegExp(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g);
    $(function(){
        $(document).on("click","a",function(e){
            var href = $(this).attr("_orighref")  ? $(this).attr("_orighref") : $(this).attr("href"),
                hosturl = window.location.href;

            if(href.indexOf("www.shihuo.cn/u?") >= 0){
                href = $.getParameterByName('url',href);
            }

            if(
                (href.indexOf("shihuo.cn") < 0 || href.indexOf("www.shihuo.cn/u?") > 0 || href.indexOf("go.shihuo.cn") >= 0 )
                && (href.indexOf("/") != 0)
                && (href.indexOf("#") != 0)
                && (href.indexOf("?") != 0)
                && href.indexOf("javascript") < 0
                && href.match(reg)
            ){
                // $.get("//www.shihuo.cn/app_swoole_statics/_golinkstatics",{
                //     refer_url:hosturl,
                //     clk:href,
                //     source:0,
                //     vst:$.cookie("__dacevst"),
                //     vid:$.cookie("_dacevid3") || $.cookie("_dacevid2")
                // });
            }
            return
        });

        $.match({
            link:'\/(tuangou|groupon)',
            callback:function(){
                var dom = $("<a class='tuangou-help-icon' />").css({
                    "position":"fixed",
                    "right":"50%",
                    "top":"425px",
                    "margin-right":"-659px",
                    "width":"110px",
                    "height":"110px",
                    "display":"block",
                    "background":"url('//sh1.hoopchina.com.cn/images/trade/groupon/tuangou-help-icon.png') no-repeat transparent"
                }).attr({
                    "href":"//www.shihuo.cn/shihuo/helpbuy",
                    "target":"_blank"
                });
                $("#returnTop").css({"height":"50px","bottom":"10px"});
                $("body").append(dom);
            }
        });
        function cookieParse(name, value, options){//cookie
		    if (typeof value != 'undefined') {
		        options = options || {};
		        if (value === null) {
		            value = '';
		            options.expires = -1;
		        }
		        var expires = '';
		        if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {
		            var date;
		            if (typeof options.expires == 'number') {
		                date = new Date();
		                date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));
		            } else {
		                date = options.expires;
		            }
		            expires = '; expires=' + date.toUTCString();
		        }
		        var path = options.path ? '; path=' + options.path : '';
		        var domain = options.domain ? '; domain=' + options.domain : '';
		        var secure = options.secure ? '; secure' : '';
		        document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('');
		    } else {
		        var cookieValue = null;
		        if (document.cookie && document.cookie != '') {
		            var cookies = document.cookie.split(';');
		            for (var i = 0; i < cookies.length; i++) {
		                var cookie = $.trim(cookies[i]);
		                if (cookie.substring(0, name.length + 1) == (name + '=')) {
		                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
		                    break;
		                }
		            }
		        }
		        return cookieValue;
		    }
		}
        function setHTML(){
		    function setCookie(objName, objValue, objHours){//添加cookie   
	            var str = objName + "=" + escape(objValue);   
	            if (objHours > 0) {//为0时不设定过期时间，浏览器关闭时cookie自动消失   
	                var date = new Date();   
	                //var ms = objHours * 3600 * 1000;   
	                date.setTime(date.getTime() + objHours); 

	                str += "; expires=" + date.toGMTString()+";path=/";   
	            }   
	            document.cookie = str;    
	        }  
		    function getCookie(name){
				var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
				if(arr=document.cookie.match(reg)){
					return unescape(arr[2]);
				}else{
					return null;
				}
			}
			if(getCookie("hongbaoFbPcCookie")*1 >= 5){
	        	return false;
	        }
		    var double11str = '',left,margin,domW = $('.hp-header').width(),minW = domW + 150,marginL = parseInt(domW/2) + 75;
		    var winW = $(window).width();
		        if(winW < minW){
		            left = 0;
		            margin = '50px 0 0 0';
		        }else{
		            left = '50%';
		            margin = '200px 0 0 -'+620+'px';
		        }
            var double11str = '<div class="shihuo-double11-btn" style="position:fixed;width:60px;left:'+left+';bottom:40px;margin:'+margin+';z-index:99;" ><a target="_blank" href="http://www.shihuo.cn/shihuo_activity_shihuopc_page.html"><img width="100%" src="https://shihuo.hupucdn.com/1111/shihuo_01.png" /></a><i class="shihuo-double11-close" style="width:20px; height:20px;position:absolute; right:-8px; top:-8px; cursor:pointer;"><img src="//sh1.hoopchina.com.cn/images/trademobile/red-package-close-2.png" width="20" /></i></div>';

		        $("body").append(double11str);
		        var goDate = new Date();
		        var nowDate = new Date();
				goDate.setHours(0,0,0,0);
		        var getTime = 24*3600*1000-(nowDate.getTime()-goDate.getTime());//获取时间戳
		           // getDate = Math.abs(nTime)/(1000*60*60*24),
		        var getHours = Math.abs(getTime)/(1000*60*60);//获取小时
		            //getMinutes = Math.abs(nTime)/(1000*60);
		       // setCookie("hongbaoFbPcCookie",1,getTime);
              
               if(getCookie("hongbaoFbPcCookie") != null){
                    setCookie("hongbaoFbPcCookie",getCookie("hongbaoFbPcCookie")*1+1,getTime);
               }else{
                  setCookie("hongbaoFbPcCookie",1,getTime);
               } 
		       $(".shihuo-double11-close").click(function(){
                  setCookie("hongbaoFbPcCookie",5,getTime);
                  $(".shihuo-double11-btn").remove();
		       });

               $(".shihuo-double11-btn a").click(function(){
                   setCookie("hongbaoFbPcCookie",5,getTime);
                   $(".shihuo-double11-btn").remove();
               });
		}
		var dateStr = new Date("2019/10/20 23:59:59").getTime(),
            dateStr2 = new Date("2019/11/11 23:59:59").getTime(),
            shuangtoday = new Date().getTime();

        if(shuangtoday > dateStr && shuangtoday <= dateStr2){
            setHTML();
        }

        function resetHB(){
            var w = $(window).height(),h = $("#shuan11HB").height();
            var t = (w-h)/ 2,ht = $("#shihuo-nav-area").offset().top + $("#shihuo-nav-area").height()+20;
            if($(".animate").css("display") == "block"){
                $("#shuan11HB").css("top","10px");
                var timer = setInterval(function(){
                    if($(".animate").css("display") == "none"){
                        ht = 183;
                        t < ht && (t = ht);
                        $("#shuan11HB").css("top",t);
                        clearInterval(timer);
                    }
                },500);
            }else{
                t < ht && (t = ht);
                $("#shuan11HB").css("top",t);
            }
            if($(window).width() < 1340){
                $("#shuan11HB").hide();
            }else{
                $("#shuan11HB").show();
            }
        }

        if($(window).width() < 1340){
            $("#shuan11HB").hide();
        }else{
            $("#shuan11HB").show();
        }
        $(window).resize(resetHB);

        $("#doubleimg area").live("click",function(){
            __dace.sendEvent($(this).attr("data-daceEvent"));
        });
        //双十一 end

        //2017黑五 start
        //11.22
        $.time_range("2017:10:21:23:59:59", "2017:10:22:23:59:58",function () {
            function heiwuSidebar() {
                var top = $(".adall-area-top").is(":visible") ? '-81px' : '-161px';
                var str = '\
                    <style>\
                    .heiwu-sidebar{\
                        width: 122px;\
                        height: 378px;\
                        position: fixed;\
                        left: 50%;\
                        top:50%;\
                        margin:'+top+' 0 0 -682px;\
                    }\
                    .heiwu-sidebar map area{\
                        outline: none;\
                    }\
                    </style>\
                    <div class="heiwu-sidebar">\
                    <img hidefocus="true" usemap="#heiwuSidebar" width="100%" src="//sh1.hoopchina.com.cn/images/trade/haitao/heiwusidebar_twoday.png" alt="">\
                        <map name="heiwuSidebar" id="heiwuSidebar">\
                            <area shape="rect" coords="0,143,122,206" target="_blank" href="//www.haitaodashi.cn#hongbao" alt="领红包">\
                            <area shape="rect" coords="0,206,122,246" target="_blank" href="//www.shihuo.cn/tejia" alt="今日免邮">\
                            <area shape="rect" coords="0,246,122,286" target="_blank" href="//www.shihuo.cn/column/17.html" alt="超值优惠">\
                            <area shape="rect" coords="0,286,122,328" target="_blank" href="//www.shihuo.cn/column/214.html" alt="全球大牌">\
                            <area shape="rect" coords="0,328,122,370" target="_blank" href="//www.shihuo.cn/mobile" alt="限量秒杀">\
                        </map>\
                    </div>\
                    \
                ';
                $(str).appendTo('body');
            }
            if($(".adall-area-top .animate").is(":visible")){
                setTimeout(heiwuSidebar,5000);
            }else{
                heiwuSidebar();
            }
        });
        //11.23
        $.time_range("2017:10:22:23:59:59", "2017:10:23:23:59:58",function () {
            function heiwuSidebar() {
                var top = $(".adall-area-top").is(":visible") ? '-81px' : '-161px';
                var str = '\
                    <style>\
                    .heiwu-sidebar{\
                        width: 122px;\
                        height: 378px;\
                        position: fixed;\
                        left: 50%;\
                        top:50%;\
                        margin:'+top+' 0 0 -682px;\
                    }\
                    .heiwu-sidebar map area{\
                        outline: none;\
                    }\
                    </style>\
                    <div class="heiwu-sidebar">\
                    <img hidefocus="true" usemap="#heiwuSidebar" width="100%" src="//sh1.hoopchina.com.cn/images/trade/haitao/heiwusidebar_oneday.png" alt="">\
                        <map name="heiwuSidebar" id="heiwuSidebar">\
                            <area shape="rect" coords="0,143,122,206" target="_blank" href="//www.haitaodashi.cn#hongbao" alt="领红包">\
                            <area shape="rect" coords="0,206,122,246" target="_blank" href="//www.shihuo.cn/tejia" alt="今日免邮">\
                            <area shape="rect" coords="0,246,122,286" target="_blank" href="//www.shihuo.cn/column/17.html" alt="超值优惠">\
                            <area shape="rect" coords="0,286,122,328" target="_blank" href="//www.shihuo.cn/column/214.html" alt="全球大牌">\
                            <area shape="rect" coords="0,328,122,370" target="_blank" href="//www.shihuo.cn/mobile" alt="限量秒杀">\
                        </map>\
                    </div>\
                    \
                ';
                $(str).appendTo('body');
            }
            if($(".adall-area-top .animate").is(":visible")){
                setTimeout(heiwuSidebar,5000);
            }else{
                heiwuSidebar();
            }
        });
        //11.24-11.26
        $.time_range("2017:10:23:23:59:59", "2017:10:26:23:59:58",function () {
            function heiwuSidebar() {
                var top = $(".adall-area-top").is(":visible") ? '-81px' : '-161px';
                var str = '\
                    <style>\
                    .heiwu-sidebar{\
                        width: 122px;\
                        height: 378px;\
                        position: fixed;\
                        left: 50%;\
                        top:50%;\
                        margin:'+top+' 0 0 -682px;\
                    }\
                    .heiwu-sidebar map area{\
                        outline: none;\
                    }\
                    </style>\
                    <div class="heiwu-sidebar">\
                    <img hidefocus="true" usemap="#heiwuSidebar" width="100%" src="//sh1.hoopchina.com.cn/images/trade/haitao/heiwusidebar_totay.png" alt="">\
                        <map name="heiwuSidebar" id="heiwuSidebar">\
                            <area shape="rect" coords="0,123,122,186" target="_blank" href="//www.haitaodashi.cn#hongbao" alt="领红包">\
                            <area shape="rect" coords="0,186,122,226" target="_blank" href="//www.shihuo.cn/tejia" alt="今日免邮">\
                            <area shape="rect" coords="0,226,122,266" target="_blank" href="//www.shihuo.cn/column/17.html" alt="超值优惠">\
                            <area shape="rect" coords="0,266,122,308" target="_blank" href="//www.shihuo.cn/column/214.html" alt="全球大牌">\
                            <area shape="rect" coords="0,308,122,350" target="_blank" href="//www.shihuo.cn/mobile" alt="限量秒杀">\
                        </map>\
                    </div>\
                    \
                ';
                $(str).appendTo('body');
            }
            if($(".adall-area-top .animate").is(":visible")){
                setTimeout(heiwuSidebar,5000);
            }else{
                heiwuSidebar();
            }
        });
        //11.27
        $.time_range("2017:10:26:23:59:59", "2017:10:27:12:00:00",function () {
            function heiwuSidebar() {
                var top = $(".adall-area-top").is(":visible") ? '-81px' : '-161px';
                var str = '\
                    <style>\
                    .heiwu-sidebar{\
                        width: 122px;\
                        height: 378px;\
                        position: fixed;\
                        left: 50%;\
                        top:50%;\
                        margin:'+top+' 0 0 -682px;\
                    }\
                    .heiwu-sidebar map area{\
                        outline: none;\
                    }\
                    </style>\
                    <div class="heiwu-sidebar">\
                    <img hidefocus="true" usemap="#heiwuSidebar" width="100%" src="//sh1.hoopchina.com.cn/images/trade/haitao/heiwusidebar_monday.png" alt="">\
                        <map name="heiwuSidebar" id="heiwuSidebar">\
                            <area shape="rect" coords="0,123,122,186" target="_blank" href="//www.haitaodashi.cn#hongbao" alt="领红包">\
                            <area shape="rect" coords="0,186,122,226" target="_blank" href="//www.shihuo.cn/tejia" alt="今日免邮">\
                            <area shape="rect" coords="0,226,122,266" target="_blank" href="//www.shihuo.cn/column/17.html" alt="超值优惠">\
                            <area shape="rect" coords="0,266,122,308" target="_blank" href="//www.shihuo.cn/column/214.html" alt="全球大牌">\
                            <area shape="rect" coords="0,308,122,350" target="_blank" href="//www.shihuo.cn/mobile" alt="限量秒杀">\
                        </map>\
                    </div>\
                    \
                ';
                $(str).appendTo('body');
            }
            if($(".adall-area-top .animate").is(":visible")){
                setTimeout(heiwuSidebar,5000);
            }else{
                heiwuSidebar();
            }
        });
        //2017黑五 end
        //2017黑五头部海淘角标
        $.time_range("2017:10:21:23:59:59", "2017:10:27:23:59:58",function () {
            function heiwuIcon() {
                var str = '\
                    <style>\
                    .heiwu-icon{\
                        position: absolute;\
                        width: 28px;\
                        height: 14px;\
                        right: 0px;\
                        top: -5px;\
                    }\
                    </style>\
                    <div class="heiwu-icon">\
                    <img src="//sh1.hoopchina.com.cn/images/header_heiwu.png" alt="">\
                    </div>\
                    \
                ';
                $(str).appendTo('.haitao-new');
            }
            heiwuIcon();
        });
    });

    $.extend({
        getParameterByName:function(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        },
        cookie:function(name, value, options){//cookie
            if (typeof value != 'undefined') {
                options = options || {};
                if (value === null) {
                    value = '';
                    options.expires = -1;
                }
                var expires = '';
                if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {
                    var date;
                    if (typeof options.expires == 'number') {
                        date = new Date();
                        date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));
                    } else {
                        date = options.expires;
                    }
                    expires = '; expires=' + date.toUTCString();
                }
                var path = options.path ? '; path=' + options.path : '';
                var domain = options.domain ? '; domain=' + options.domain : '';
                var secure = options.secure ? '; secure' : '';
                document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('');
            } else {
                var cookieValue = null;
                if (document.cookie && document.cookie != '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = $.trim(cookies[i]);
                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        },
        match:function(obj){
            var data={"link":null,callback:function(){}};
            $.extend(data,obj);
            var href = window.location.href;
            if(data.link){
                var reg = new RegExp(data.link);
                reg.test(href) && (typeof data.callback == "function")  && data.callback();
            }
        },
        time_range:function(beginTime,endTime,fn,disableFn){
            var t = this;
            var strb = beginTime.split (":");
            if (strb.length != 6) {
                return false;
            }

            var stre = endTime.split (":");
            if (stre.length != 6) {
                return false;
            }

            var b = new Date ();
            var e = new Date ();
            var n = new Date ();

            b.setFullYear (strb[0],strb[1],strb[2]);
            b.setHours (strb[3]);
            b.setMinutes (strb[4]);
            b.setSeconds (strb[5]);

            e.setFullYear (stre[0],stre[1],stre[2]);
            e.setHours (stre[3]);
            e.setMinutes (stre[4]);
            e.setSeconds (stre[5]);

            if (n.getTime() - b.getTime() > 0 && n.getTime() - e.getTime() <= 0) {
                fn && fn();
            } else {
                disableFn && disableFn();
            }
        }
    });
    if($(".ad_position_icon").length > 0){
       $(".ad_position_icon").css("position","relative"); 
    }
    var arr = [".J_ui_picSwitch",".J_ui_picSwitch_top",".ad_position_icon"];
    var dom = '<div class="gguang-area-box-layer" style="position: absolute;left:0px;bottom:0px; z-index:20;"><img src="//sh1.hoopchina.com.cn/images/trade/gungg.png" width="24" height="14" style="width:24px;height24px;" /></div>';
    for(var i=0;i<arr.length;i++){
        $(arr[i]).append(dom);
    }
})(jQuery);